<!DOCTYPE HTML> 
<html>
	<head>
		<title>The Flying Dutchman</title>
		<link rel="stylesheet" href="css/tfd_settings.css">
		<script src="js/inventoryaccess.js"></script>
		<script src="js/admin_settings.js"></script>
		<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>

		<script>
			/* Validate email address */
			function validateEmail(email, htmlresult) { 
    			var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    			if (htmlresult == '1') {
	    			if (re.test(email))
	    				document.getElementById("resultemail").innerHTML = "<img class='valid' src='images/settings/valid.png' alt='Email valid' title='Email valid'>";
	    			else 
	    				document.getElementById("resultemail").innerHTML = "<img class='valid' src='images/settings/notvalid.png' alt='Email not valid' title='Email not valid'>";
	    		} else 
	    			return re.test(email);
			} 

			/* Validate phone */
			function validatePhone(phone, htmlresult) {
				re = /^\+?(0|[0-9]\d*)$/;;
				if (htmlresult == '1') {
					if (re.test(phone))
	    				document.getElementById("resultphone").innerHTML = "<img class='valid' src='images/settings/valid.png' alt='Phone number valid' title='Phone number valid'>";
	    			else 
	    				document.getElementById("resultphone").innerHTML = "<img class='valid' src='images/settings/notvalid.png' alt='Phone number not valid' title='Phone number not valid (Valid format [+][0-9])'>";
	    		} else 
	    			return re.test(phone);
			}

			/* Create a new user - WORKS, BUT THERE IS NO WAY TO ADD CREDIT TO A USER IN THE API */
			function createNewUser(new_username, new_password, re_password, first_name, last_name, email, phone) {
				httpGet(api+'user_edit&new_username='+new_username+'&new_password='+new_password+'&first_name='+first_name+'&last_name='+last_name+'&email='+email+'&phone='+phone, 
					function callback_success() { 
						return true;
					}, 
					function callback_error(data) {
						console.log('An error occurred: ' + data);
					});
			}

			/* Used to validate password, email and phone before the real API-function gets called */
			function callCreateNewUser(uname, pword, re_password, firstname, lastname, email, phone) {
				if ( (pword == re_password) && (validateEmail(email, '0')) && (validatePhone(phone, '0')) ) {
					console.log("It works");
					//uncomment row below before presentation
					//createNewUser(uname, pword, re_password, firstname, lastname, email, phone)
					//CALL createUser in db_login.php to create user in our local DB as well
					$.ajax({      
				      type: 'POST',                        
				      url: 'db_login.php',
				      data: 
				      { 
				        func_id : "1",
				        uname : uname,
				        pword : pword,
				        firstname : firstname,
				        lastname : lastname,
				        email : email,
				        phone : phone 
				      },                        
				      dataType: 'json'
				    });
				} else 
					console.log("Either not matching password-fields, incorrect email or phone");
			}

			/* Queries the db for five last receipts */
			function getLastFive() {
			    $.ajax({      
			      type: 'POST',                        
			      url: 'settings.php',
			      data: { 
			        func_id : "1" 
			      },                        
			      dataType: 'json',
			      success: function(data) {
			      	if (data.status == 'success') {
			      		$('#output').html('<br>'+data[0]+'<br> '+data[1]+'<br> '+data[2]+'<br> '+data[3]+'<br> '+data[4]+'');
			      	} else {
			      		console.log("db query not correct");	
			      	}
			      }
			    });
  			}

  			/* Add receipt to the db */
  			function addReceipt(str) {
			    $.ajax({      
			      type: 'POST',                        
			      url: 'settings.php',
			      data: { 
			        func_id : "0",
			        str : str 
			      },                        
			      dataType: 'json',
			      success: function(data) {
				  	if (data.status == 'success') {
				  		console.log("db query success");
				  	} else {
				  		console.log("db query failed");
				  	}
			      }
			    });
  			}

		</script>
	</head>

	<body>
		<h3> Create a new user (OBS if you create a user you add it to the API (for all students in the course)) </h3>
		<form id="newUserForm">
		<label for="firstname">Enter first name</label>	<br>
		<input id="firstname" type="text" placeholder="Enter first name" required>
		<br><br>
		<label for="lastname">Enter last name</label>	<br>
		<input id="lastname" type="text" placeholder="Enter last name" required>
		<br><br>
		<label for="uname">Enter username</label>	<br>
		<input id="uname" type="text" placeholder="Enter username" required>
		<br><br>
		<label for="pword">Enter password</label>	<br>
		<input id="pword" type="password" placeholder="Enter password" required>
		<br><br>
		<label for="re_password">Re-enter password</label>	<br>
		<input id="re_password" type="password" placeholder="Re-enter password" required>
		<br><br>
		<label for="email">Enter your email address</label>	<br>
		<input id="email" type="text" onkeyup="validateEmail(email.value, '1')" placeholder="Enter your email address" required>
		<span id="resultemail"><img class='valid' src='images/settings/15x15.png'></span>
		<br><br>
		<label for="phone">Enter your phone number</label> <br>
		<input id="phone" type="text" onkeyup="validatePhone(phone.value, '1')" placeholder="Enter your phone number" required>
		<span id="resultphone"><img class='valid' src='images/settings/15x15.png'></span>
		<br><br>
		</form>
		<button id="createUserBtn" onclick="callCreateNewUser(uname.value, pword.value, re_password.value, firstname.value, lastname.value, email.value, phone.value)" type="button"> Create new user </button>
		<button id="clearFieldBtn" onclick="document.getElementById('newUserForm').reset(), document.getElementById('resultphone').innerHTML = '', document.getElementById('resultemail').innerHTML = '', document.getElementById('firstname').focus()" type="button"> Clear fields </button>

		<br><br><br><br>

		<h3> Get five last purchases </h3>
		<button id="getLastFivePurchases" onclick="getLastFive()" type="button"> Get Last Five Purchases </button>
		<br><span id="output"> SQL Query reply will be displayed here </span>

		<br><br><br><br>

		<h3> Add receipt to system </h3>
		<button id="addReceipt" onclick="addReceipt()" type="button"> Add Receipt </button>
	</body>
</html>

